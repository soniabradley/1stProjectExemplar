<!DOCTYPE html>

<html>

<head>
	<title>
		Exemplar Profile
	</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="./assets/css/style.css">
	<meta charset="utf-8">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
					<a class="navbar-brand" href="#"><i class="fa fa-book" aria-hidden="true"></i>Exemplar</a>
					<!-- <img   src="" style = " margin-top: 5px; border-radius: 10px; background-color: white; width: 40px; height: 40px;" alt=""> -->
        </div>

		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style = "border-bottom: 1px solid gray;">

	<form class="navbar-form navbar-left">
				<div class="btn-group">
	              <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	              	<span id= "displayName"></span>
	              </button>
	              </div>
              </form>

            <form class="navbar-form navbar-right">
            	<div class="btn-group">
                	<a href="main.html" class="btn btn-link" role="button">Main Page</a>
            	</div>
              	<div class="btn-group">
                	<button type="button" class="btn btn-link dropdown-toggle logout" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-sign-out" aria-hidden="true"></i>Log Out</button>
              	</div>
            </form>
        </div>
    </div><!-- container -->
</nav>


<div class = "container-fluid">
<div class = "row">


			<div class = "jumbotron" style = " margin-left: 20%; margin-right:20%; background-color: #a14a47; box-shadow: 10px 10px 5px #888888, inset 0 -3px 3px rgba(0,0,0,0.1); border-radius: 50px;">
				<div class = "row">
					<div class = "col-md-12">
						<img id = "userImg" src="" style = "width: 50%; heihgt: 50%; margin-left: 25%; border: 5px solid #9dffe3; border-radius: 100px; background-color: #8ab4c9;" alt="">
						<h2 id = "userName" style = "text-align:center;"> name</h2>
						<p id = "profession" style = "text-align:center;"> Profession </p>
						<p id = "country" style = "text-align:center;"> country </p>
					</div>
				</div>
			</div>

			<div class = "row">

						<div class = "col-md-5" style = "box-shadow: 0 3px 6px rgba(0,0,0,0.3), inset 0 -3px 3px rgba(0,0,0,0.1);">

									<div class="row" id="personal">
												<div class="btn-group">
														<button type="button"  style = "margin:5px;" class="btn btn-primary btnAboutMe">
															About Me
														</button>
												</div>

												<div class="btn-group">
														<button type="button"  style = "margin:5px;" class="btn btn-primary btnPaper">
															Papers
														</button>
												</div>
									</div>

									<div class = "row" >
													<div class = "col-md-10">
															<div class = "listPaper hide" id="paper"> </div>
															<div id="aboutMe">About Me</div>
													</div>

													<div class = "col-md-2">
														<button type="button" class="btn btn-primary btnEdit">
															Edit
														</button>
													</div>
									</div>

<br> <br> <br>

						</div>


						<div class = "col-md-1 "></div>


						<div class = "col-md-5 " style = "box-shadow: 0 3px 6px rgba(0,0,0,0.3), inset 0 -3px 3px rgba(0,0,0,0.1); margin-bottom: 50px;">
							<label> Time Spend on Article Read </label>
							<canvas id="myChart" width="600" height="600"></canvas>
							<br><br>
							<label> Number of Article Read </label>
							<canvas id="myChartnumArticle" width="600" height="600"></canvas>
							<br><br>

							<div class = "row">
								<div class = "col-md-10">
									<h3>Notes</h3>
									<div id = "noteArea" style = "margin-bottom:50px;"></div>
								</div>
								<div class = "col-md-2">
										<button type="button" class="btn btn-primary btnEditNote" style = "margin-top:20px;">
											Add
										</button>
								</div>
							</div>




			      </div>
			</div>
			<div class = "col-md-4">
				<div>
          			<canvas id="myChart" width="400" height="400"></canvas>
        		</div>
        		<div>
          			<ol id="artRed"></ol><!-- ***************************************************** -->
        		</div>
	       	</div>
		</div>
</div>



	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
	<script src="./assets/js/moment.js" charset="utf-8"></script>
    <script src="./assets/js/chart.bundle.min.js" charset="utf-8"></script>
    <script src="./assets/js/app.js" charset="utf-8"></script>
    <script src="./assets/js/chart.js" charset="utf-8"></script>
    <script src="./assets/js/jquery-2.2.4.min.js" charset="utf-8"></script>
    <script src="./assets/js/bootstrap.min.js" charset="utf-8"></script>

	<script>




////////event listenner whenever there is a change of Auth State signing in or signing up////////
			firebase.auth().onAuthStateChanged(function(user){

				if(user){
				///////if user signed in or singed up updating user account properties///////
				var storageRef = firebase.storage().ref(user.uid+"/");
				storageRef.child(user.photoURL).getDownloadURL().then(function(url) {
					$("#userImg").attr("src", url);
				});
				} else {
					console.log("not logged in");
				}
			});

			firebase.database().ref('/users').once('value', function (data) {
				var user = firebase.auth().currentUser;
				var html = "";
				for (key in data.val()[user.uid]["papers"]) {
						$("#paper").append("<h2>"+"'"+key+"'"+"</h2>");

					for (index in data.val()[user.uid]["papers"][key]){
						if (index!=="timeRead"){
							html += "<li>" + data.val()[user.uid]["papers"][key][index]["paperTitle"] + ".  ---Time: " +data.val()[user.uid]["papers"][key][index]["timeRead"]+"sec" + "</li>";
						}
					}
					$("#paper").append(html);
					html="";
				}

				for (var j in data.val()[user.uid]["Notes"]){
					var htmll = ("<li>" + data.val()[user.uid]["Notes"][j] + "</li>" + "<br>");
					$("#noteArea").append(htmll);
				}
					console.log("yukarisi");

				$("#userName").text(data.val()[user.uid]["displayName"]);
				$("#profession").html("<h3>" + data.val()[user.uid]["profession"] + "</h3>");
				$("#aboutMe").html("<h3>" + data.val()[user.uid]["aboutMe"] + "</h3>");
				$("#country").html("<small>" + data.val()[user.uid]["country"] + "</small>");
			});


$(document).on("click",".btnPaper", function(event){
		event.preventDefault();
		$("#paper").attr("class","show");
		$("#aboutMe").attr("class","hide");
});

$(document).on("click",".btnAboutMe", function(event){
		event.preventDefault();
		$("#paper").attr("class","hide");
		$("#aboutMe").attr("class","show");
});

$(document).on("click",".btnEdit", function(event){
		event.preventDefault();
		$(this).attr("class", "btn btn-primary btnSave");
		$(this).text("Save");
		$("#paper").attr("class","hide");
		$("#aboutMe").attr("class","show");
		$("#aboutMe").html("<textarea id = 'text'>");
});


$(document).on("click",".btnSave", function(event){
		event.preventDefault();
		var user = firebase.auth().currentUser;
		firebase.database().ref('/users/'+ user.uid ).update({aboutMe: $("#text").val()});
		$("#aboutMe").html("<h2>" + $("#text").val() + "</h2>");
		$(this).attr("class", "btn btn-primary btnEdit");
		$(this).text("Edit");
});

$(document).on("click",".btnEditNote", function(event){
		event.preventDefault();
		$(this).attr("class", "btn btn-primary btnSaveNote");
		$(this).text("Save");
		var text = $("<textarea id = 'textNote'>");
		text.insertAfter($("#noteArea"));
});



$(document).on("click",".btnSaveNote", function(event){
		event.preventDefault();
		var user = firebase.auth().currentUser;
		var count = 0;
		firebase.database().ref('/users/'+user.uid+"/Notes").once('value', function (data) {

			if (typeof(data.val())!=="string"){
					for (var i in data.val()) {
					    if (data.val().hasOwnProperty(i)) {
					        count++;
					    }
					}
			}
			count++;
			firebase.database().ref('/users/'+ user.uid +"/Notes").child(count).set($("#textNote").val());
		});
		var html = "<li>" +$("#textNote").val() + "</li>"+"<br>";
		$("#noteArea").append(html);
		$("#textNote").remove();
		$(this).attr("class", "btn btn-primary btnEditNote");
		$(this).text("Add");
});

	</script>
</body>
</html>
